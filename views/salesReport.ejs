<%- include('header')-%>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
      <div class="min-height-300 bg-dark position-absolute w-100"></div>
      <aside class="sidenav bg-white navbar navbar-vertical navbar-expand-xs border-0 border-radius-xl my-3 fixed-start ms-4 " id="sidenav-main">
        <div class="sidenav-header">
          <i class="fas fa-times p-3 cursor-pointer text-secondary opacity-5 position-absolute end-0 top-0 d-none d-xl-none" aria-hidden="true" id="iconSidenav"></i>
          <a class="navbar-brand m-0" href=" https://demos.creative-tim.com/argon-dashboard/pages/dashboard.html " target="_blank">
            <img src="/assets/img/logo-ct-dark.png" class="navbar-brand-img h-100" alt="main_logo">
            <span class="ms-1 font-weight-bolder"> <span class="font-weight-normal">PINK</span> MARTINI</span>
          </a>
        </div>
        <hr class="horizontal dark mt-0">
        <div class="collapse navbar-collapse  w-auto " id="sidenav-collapse-main">
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link active" href="/admin/login">
                <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
                  <i class="ni ni-tv-2 text-primary text-sm opacity-10"></i>
                </div>
                <span class="nav-link-text ms-1">Dashboard</span>
              </a>
            </li>
          <!-- <form action="/category" method="GET"> -->
            <li class="nav-item ">
              <a class="nav-link " href="/admin/category">
                <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
                  <i class="ni ni-calendar-grid-58 text-warning text-sm opacity-10"></i>
                </div>
                <span class="nav-link-text ms-1">Category</span>
              </a>
            </li>
          <!-- </form> -->
            <li class="nav-item">
              <a class="nav-link " href="/admin/Products">
                <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
                  <i class="ni ni-credit-card text-success text-sm opacity-10"></i>
                </div>
                <span class="nav-link-text ms-1">Products</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link " href="/admin/orders">
                <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
                  <i class="ni ni-app text-info text-sm opacity-10"></i>
                </div>
                <span class="nav-link-text ms-1">Orders</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link " href="/admin/users">
                <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
                  <i class="ni ni-world-2 text-danger text-sm opacity-10"></i>
                </div>
                <span class="nav-link-text ms-1">Users</span>
              </a>
            </li>
            <!-- <li class="nav-item mt-3">
              <h6 class="ps-4 ms-2 text-uppercase text-xs font-weight-bolder opacity-6">Account pages</h6>
            </li> -->
            
            <li class="nav-item">
              <a class="nav-link " href="/admin/coupons">
                <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
                  <i class="ni ni-single-copy-04 text-warning text-sm opacity-10"></i>
                </div>
                <span class="nav-link-text ms-1">Coupons</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link " href="/admin/offers">
                <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
                  <i class="ni ni-collection text-info text-sm opacity-10"></i>
                </div> 
                <span class="nav-link-text ms-1">Category Offers</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link " href="/admin/ProductOffersPage">
                <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
                  <i class="ni ni-collection text-info text-sm opacity-10"></i>
                </div>
                <span class="nav-link-text ms-1">Product Offers</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link " href="/admin/Sales Report">
                <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
                  <i class="ni ni-collection text-info text-sm opacity-10"></i>
                </div>
                <span class="nav-link-text ms-1">Sales Report</span>
              </a>
            </li>
           
            <li class="nav-item">
              <a class="nav-link " href="/admin/logout">
                <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
                  <i class="ni ni-collection text-info text-sm opacity-10"></i>
                </div>
                <span class="nav-link-text ms-1">Logout</span>
              </a>
            </li>
          </ul>
        </div>
       
      </aside>
     

      <div class="row mt-4">
        <div class="col-lg-9 mb-lg-0 mb-4" style="margin-left: 300px; margin-top: 100px;">
          <div class="card">
            <div class="card-header pb-0 p-3">
              <div class="d-flex justify-content-between">
                <h6 class="mb-2">Sales Report</h6>
                <div>
                    <button onclick="generatePDF()" class="btn btn-sm btn-outline-primary me-2">Download PDF</button>
                    <button onclick="generateExcel()" class="btn btn-sm btn-outline-success">Download Excel</button>
                  </div>
              </div>
              <form id="reportForm" action="/admin/salesReport" method="GET">
                <div class="form-row">
                  <div class="form-group col-md-3">
                    <label for="reportType">Report Type</label>
                    <select class="form-control" id="reportType" name="reportType">
                      <option value="daily" <%= reportType === 'daily' ? 'selected' : '' %>>Daily</option>
                      <option value="weekly" <%= reportType === 'weekly' ? 'selected' : '' %>>Weekly</option>
                      <option value="monthly" <%= reportType === 'monthly' ? 'selected' : '' %>>Monthly</option>
                      <option value="yearly" <%= reportType === 'yearly' ? 'selected' : '' %>>Yearly</option>
                      <option value="custom" <%= reportType === 'custom' ? 'selected' : '' %>>Custom</option>
                    </select>
                  </div>
                  <div class="form-group col-md-3" id="singleDateDiv">
                    <label for="date">Select Date</label>
                    <input type="date" class="form-control" id="date" name="date" value="<%= selectedDate %>">
                  </div>
                  <div class="form-group col-md-3" id="startDateDiv" style="display: none;">
                    <label for="startDate">Start Date</label>
                    <input type="date" class="form-control" id="startDate" name="startDate" value="<%= startDate %>">
                  </div>
                  <div class="form-group col-md-3" id="endDateDiv" style="display: none;">
                    <label for="endDate">End Date</label>
                    <input type="date" class="form-control" id="endDate" name="endDate" value="<%= endDate %>">
                  </div>
                  <div class="form-group col-md-3">
                    <label>&nbsp;</label>
                    <button type="submit" class="btn btn-primary form-control">Generate Report</button>

                    <h3></h3>
                  </div>
                </div>
              </form>
            </div>
            
            <div class="card-body">
                <h5><%= reportTitle %></h5>
                <h5>Total orders in range : <%=countOrders  %></h5>
                
                <% if (orders && orders.length > 0) { %>
                  <div class="table-responsive">
                    <table class="table align-items-center">
                      <thead>
                        <tr>
                          <th scope="col">Sl. No</th>
                          <th scope="col">Order ID</th>
                          <th scope="col">Total Amount</th>
                          <th scope="col">offer Price</th>
                          <th scope="col">Coupon Discount</th>
                          <th scope="col">Date</th>
                          <th scope="col">Payment Method</th>
                          <th scope="col">Payment Status</th>
                        </tr>
                      </thead>
                      <tbody>
                        <% orders.forEach((order, index) => { %>
                          <tr>
                            <td style="padding-left: 40px;"><%= index + 1 %></td>
                            <td><%= order.orderId %></td>
                            <td style="padding-left: 40px;"><%= order.total %></td>
                            <td style="padding-left: 50px;"><%= Math.round(order.totalPayable) %></td>
                            <td style="padding-left: 70px;"><%= order.CouponDiscount %></td>
                            <td style="padding-left: 15px;"><%= order.createdAt %></td>
                            <td style="padding-left: 30px;"><%= order.paymentMethod %></td>
                            <td style="padding-left: 40px;"><%= order.paymentStatus %></td>
                          </tr>
                        <% }) %>
                      </tbody>
                    </table>
                  </div>
                <% } else { %>
                  <p>No orders found for the selected period.</p>
                  
                  <div class="card mt-4">
                    <div class="card-header pb-0 p-3">
                      <h6 class="mb-2">All Time Sales Report</h6>
                      <h6 class="mb-2">Orders : <%=allcount  %></h6>
                    </div>
                    <div class="card-body">
                      <div class="table-responsive">
                        <table class="table align-items-center">
                          <thead>
                            <tr>
                              <th scope="col">Sl. No</th>
                              <th scope="col">Order ID</th>
                              <th scope="col">Total price</th>
                              <th scope="col">Offer Price</th>
                              <th scope="col">Coupon Discount</th>
                              <th scope="col">Date</th>
                              <th scope="col">Payment Method</th>
                              <th scope="col">Payment Status</th>
                            </tr>
                          </thead>
                          <tbody>
                            <% allTimeOrders.forEach((order, index) => { %>
                              <tr>
                                <td style="padding-left: 40px;"><%= index + 1 %></td>
                                <td><%= order.orderId %></td>
                                <td style="padding-left: 40px;"><%= order.total %></td>
                                <td style="padding-left: 50px;"><%= Math.round(order.totalPayable) %></td>
                                <td style="padding-left: 70px;"><%= order.CouponDiscount %></td>
                                <td style="padding-left: 15px;"><%= order.createdAt %></td>
                                <td style="padding-left: 30px;"><%= order.paymentMethod %></td>
                                <td style="padding-left: 40px;"><%= order.paymentStatus %></td>
                              </tr>
                            <% }) %>
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                <% } %>
              </div>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
      <script>
        function updateDateRanges() {
          const reportType = document.getElementById('reportType').value;
          const dateInput = document.getElementById('date');
          const startDateInput = document.getElementById('startDate');
          const endDateInput = document.getElementById('endDate');
          const singleDateDiv = document.getElementById('singleDateDiv');
          const startDateDiv = document.getElementById('startDateDiv');
          const endDateDiv = document.getElementById('endDateDiv');
      
          let selectedDate = moment(dateInput.value);
          if (!selectedDate.isValid()) {
            selectedDate = moment(); // Use current date if no date is selected
            dateInput.value = selectedDate.format('YYYY-MM-DD');
          }
      
          switch (reportType) {
            case 'daily':
              startDateInput.value = selectedDate.format('YYYY-MM-DD');
              endDateInput.value = selectedDate.format('YYYY-MM-DD');
              singleDateDiv.style.display = 'block';
              startDateDiv.style.display = 'none';
              endDateDiv.style.display = 'none';
              break;
            case 'weekly':
              startDateInput.value = selectedDate.clone().subtract(6, 'days').format('YYYY-MM-DD');
              endDateInput.value = selectedDate.format('YYYY-MM-DD');
              singleDateDiv.style.display = 'block';
              startDateDiv.style.display = 'none';
              endDateDiv.style.display = 'none';
              break;
            case 'monthly':
              startDateInput.value = selectedDate.clone().startOf('month').format('YYYY-MM-DD');
              endDateInput.value = selectedDate.clone().endOf('month').format('YYYY-MM-DD');
              singleDateDiv.style.display = 'block';
              startDateDiv.style.display = 'none';
              endDateDiv.style.display = 'none';
              break;
            case 'yearly':
              startDateInput.value = selectedDate.clone().startOf('year').format('YYYY-MM-DD');
              endDateInput.value = selectedDate.clone().endOf('year').format('YYYY-MM-DD');
              singleDateDiv.style.display = 'block';
              startDateDiv.style.display = 'none';
              endDateDiv.style.display = 'none';
              break;
            case 'custom':
              singleDateDiv.style.display = 'none';
              startDateDiv.style.display = 'block';
              endDateDiv.style.display = 'block';
              break;
          }
        }
      
        document.getElementById('reportType').addEventListener('change', updateDateRanges);
        document.getElementById('date').addEventListener('change', updateDateRanges);
      
        // Initialize date ranges on page load
        document.addEventListener('DOMContentLoaded', updateDateRanges);


                    function generatePDF() {
                            const { jsPDF } = window.jspdf;
                            const doc = new jsPDF();

                            // Add title
                            doc.setFontSize(18);
                            doc.text('Sales Report', 14, 22);

                            // Add report type and date range
                            const reportType = document.getElementById('reportType').value;
                            const startDate = document.getElementById('startDate').value;
                            const endDate = document.getElementById('endDate').value;
                            doc.setFontSize(12);
                            doc.text(`Report Type: ${reportType}`, 14, 32);
                            doc.text(`Date Range: ${startDate} to ${endDate}`, 14, 40);

                            // Add table
                            const headers = [['Sl. No', 'Order ID', 'Total Amount', 'Total Payable', 'Coupon Discount', 'Date', 'Payment Method', 'Payment Status']];
                            const data = Array.from(document.querySelectorAll('table tbody tr')).map(row => {
                                return Array.from(row.cells).map(cell => cell.textContent.trim());
                            });

                            doc.autoTable({
                                head: headers,
                                body: data,
                                startY: 50,
                                theme: 'grid'
                            });

                            // Save the PDF
                            doc.save('sales_report.pdf');
                            }

                            function generateExcel() {
                            // Prepare data
                            const headers = ['Sl. No', 'Order ID', 'Total Amount', 'Total Payable', 'Coupon Discount', 'Date', 'Payment Method', 'Payment Status'];
                            const data = Array.from(document.querySelectorAll('table tbody tr')).map(row => {
                                return Array.from(row.cells).map(cell => cell.textContent.trim());
                            });

                            // Create workbook and worksheet
                            const wb = XLSX.utils.book_new();
                            const ws = XLSX.utils.aoa_to_sheet([headers, ...data]);

                            // Add worksheet to workbook
                            XLSX.utils.book_append_sheet(wb, ws, 'Sales Report');

                            // Generate Excel file
                            XLSX.writeFile(wb, 'sales_report.xlsx');
                            }
                </script>
      
          <footer class="footer pt-3  ">
            <div class="container-fluid">
              <div class="row align-items-center justify-content-lg-between">
              
               
              </div>
            </div>
          </footer>
        </div>
      </main>
      <div class="fixed-plugin">
        <a class="fixed-plugin-button text-dark position-fixed px-3 py-2">
          <i class="fa fa-cog py-2"> </i>
        </a>
        <div class="card shadow-lg">
          <div class="card-header pb-0 pt-3 ">
            <div class="float-start">
              <h5 class="mt-3 mb-0">Argon Configurator</h5>
              <p>See our dashboard options.</p>
            </div>
            <div class="float-end mt-4">
              <button class="btn btn-link text-dark p-0 fixed-plugin-close-button">
                <i class="fa fa-close"></i>
              </button>
            </div>
            <!-- End Toggle Button -->
          </div>
          <hr class="horizontal dark my-1">
          <div class="card-body pt-sm-3 pt-0 overflow-auto">
            <!-- Sidebar Backgrounds -->
            <div>
              <h6 class="mb-0">Sidebar Colors</h6>
            </div>
            <a href="javascript:void(0)" class="switch-trigger background-color">
              <div class="badge-colors my-2 text-start">
                <span class="badge filter bg-gradient-primary active" data-color="primary" onclick="sidebarColor(this)"></span>
                <span class="badge filter bg-gradient-dark" data-color="dark" onclick="sidebarColor(this)"></span>
                <span class="badge filter bg-gradient-info" data-color="info" onclick="sidebarColor(this)"></span>
                <span class="badge filter bg-gradient-success" data-color="success" onclick="sidebarColor(this)"></span>
                <span class="badge filter bg-gradient-warning" data-color="warning" onclick="sidebarColor(this)"></span>
                <span class="badge filter bg-gradient-danger" data-color="danger" onclick="sidebarColor(this)"></span>
              </div>
            </a>
            <!-- Sidenav Type -->
            <div class="mt-3">
              <h6 class="mb-0">Sidenav Type</h6>
              <p class="text-sm">Choose between 2 different sidenav types.</p>
            </div>
            <div class="d-flex">
              <button class="btn bg-gradient-primary w-100 px-3 mb-2 active me-2" data-class="bg-white" onclick="sidebarType(this)">White</button>
              <button class="btn bg-gradient-primary w-100 px-3 mb-2" data-class="bg-default" onclick="sidebarType(this)">Dark</button>
            </div>
            <p class="text-sm d-xl-none d-block mt-2">You can change the sidenav type just on desktop view.</p>
            <!-- Navbar Fixed -->
            <div class="d-flex my-3">
              <h6 class="mb-0">Navbar Fixed</h6>
              <div class="form-check form-switch ps-0 ms-auto my-auto">
                <input class="form-check-input mt-1 ms-auto" type="checkbox" id="navbarFixed" onclick="navbarFixed(this)">
              </div>
            </div>
            <hr class="horizontal dark my-sm-4">
            <div class="mt-2 mb-5 d-flex">
              <h6 class="mb-0">Light / Dark</h6>
              <div class="form-check form-switch ps-0 ms-auto my-auto">
                <input class="form-check-input mt-1 ms-auto" type="checkbox" id="dark-version" onclick="darkMode(this)">
              </div>
            </div>
            <a class="btn bg-gradient-dark w-100" href="https://www.creative-tim.com/product/argon-dashboard">Free Download</a>
            <a class="btn btn-outline-dark w-100" href="https://www.creative-tim.com/learning-lab/bootstrap/license/argon-dashboard">View documentation</a>
            <div class="w-100 text-center">
              <a class="github-button" href="https://github.com/creativetimofficial/argon-dashboard" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="Star creativetimofficial/argon-dashboard on GitHub">Star</a>
              <h6 class="mt-3">Thank you for sharing!</h6>
              <a href="https://twitter.com/intent/tweet?text=Check%20Argon%20Dashboard%20made%20by%20%40CreativeTim%20%23webdesign%20%23dashboard%20%23bootstrap5&amp;url=https%3A%2F%2Fwww.creative-tim.com%2Fproduct%2Fargon-dashboard" class="btn btn-dark mb-0 me-2" target="_blank">
                <i class="fab fa-twitter me-1" aria-hidden="true"></i> Tweet
              </a>
              <a href="https://www.facebook.com/sharer/sharer.php?u=https://www.creative-tim.com/product/argon-dashboard" class="btn btn-dark mb-0 me-2" target="_blank">
                <i class="fab fa-facebook-square me-1" aria-hidden="true"></i> Share
              </a>
            </div>
          </div>
        </div>
      </div>
      <!--   Core JS Files   -->
      <script src="/assets/js/core/popper.min.js"></script>
      <script src="/assets/js/core/bootstrap.min.js"></script>
      <script src="/assets/js/plugins/perfect-scrollbar.min.js"></script>
      <script src="/assets/js/plugins/smooth-scrollbar.min.js"></script>
      <script src="/assets/js/plugins/chartjs.min.js"></script>
      <script>
        var ctx1 = document.getElementById("chart-line").getContext("2d");
    
        var gradientStroke1 = ctx1.createLinearGradient(0, 230, 0, 50);
    
        gradientStroke1.addColorStop(1, 'rgba(94, 114, 228, 0.2)');
        gradientStroke1.addColorStop(0.2, 'rgba(94, 114, 228, 0.0)');
        gradientStroke1.addColorStop(0, 'rgba(94, 114, 228, 0)');
        new Chart(ctx1, {
          type: "line",
          data: {
            labels: ["Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
            datasets: [{
              label: "Mobile apps",
              tension: 0.4,
              borderWidth: 0,
              pointRadius: 0,
              borderColor: "#5e72e4",
              backgroundColor: gradientStroke1,
              borderWidth: 3,
              fill: true,
              data: [50, 40, 300, 220, 500, 250, 400, 230, 500],
              maxBarThickness: 6
    
            }],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false,
              }
            },
            interaction: {
              intersect: false,
              mode: 'index',
            },
            scales: {
              y: {
                grid: {
                  drawBorder: false,
                  display: true,
                  drawOnChartArea: true,
                  drawTicks: false,
                  borderDash: [5, 5]
                },
                ticks: {
                  display: true,
                  padding: 10,
                  color: '#fbfbfb',
                  font: {
                    size: 11,
                    family: "Open Sans",
                    style: 'normal',
                    lineHeight: 2
                  },
                }
              },
              x: {
                grid: {
                  drawBorder: false,
                  display: false,
                  drawOnChartArea: false,
                  drawTicks: false,
                  borderDash: [5, 5]
                },
                ticks: {
                  display: true,
                  color: '#ccc',
                  padding: 20,
                  font: {
                    size: 11,
                    family: "Open Sans",
                    style: 'normal',
                    lineHeight: 2
                  },
                }
              },
            },
          },
        });
      </script>
      <script>
        var win = navigator.platform.indexOf('Win') > -1;
        if (win && document.querySelector('#sidenav-scrollbar')) {
          var options = {
            damping: '0.5'
          }
          Scrollbar.init(document.querySelector('#sidenav-scrollbar'), options);
        }
      </script>
      <!-- Github buttons -->
      <script async defer src="https://buttons.github.io/buttons.js"></script>
      <!-- Control Center for Soft Dashboard: parallax effects, scripts for the example pages etc -->
      <script src="/assets/js/argon-dashboard.min.js?v=2.0.4"></script>
      <%- include('footer')-%>